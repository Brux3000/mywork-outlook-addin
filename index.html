<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MyWork</title>
    <!-- Office JS API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>

    <script type="text/javascript">
        // Make sure Office is initialized
        Office.initialize = function () {
            Office.actions.associate("copySubject", copySubject);
        };


        function copySubject(event) {
            Office.context.mailbox.item.subject.getAsync(function (asyncResult) {
                if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
                    var subject = asyncResult.value;
                    copyToClipboard(subject);
                    document.getElementById('messaggio').innerHTML = "Oggetto copiato negli appunti: " + subject;
                } else {
                    document.getElementById('messaggio').innerHTML = "Errore nel recupero dell'oggetto";
                }

                document.getElementById('messaggio').style.display = 'block';

                // ✅ Indica che l’azione è completata
                event.completed();
            });
        }


        // Funzione per copiare testo negli appunti
        function copyToClipboard(text) {
            // Crea elemento testuale temporaneo
            var textArea = document.createElement('textarea');
            textArea.value = text;
            
            // Nascondi l'elemento ma aggiungilo al DOM
            textArea.style.position = 'fixed';
            textArea.style.left = '0px';
            textArea.style.top = '0px';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            
            // Seleziona e copia
            textArea.select();
            document.execCommand('copy');
            
            // Ripulisci rimuovendo l'elemento temporaneo
            document.body.removeChild(textArea);
        }
    </script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0;
            padding: 10px;
        }
        .container {
            text-align: center;
        }
        .button {
            background-color: #0078d4;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
            border-radius: 4px;
        }
        .button:hover {
            background-color: #005a9e;
        }
        .messaggio {
            margin-top: 15px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MyWork: Copia Oggetto Email</h1>
        <p>Con questo add-in puoi copiare l'oggetto della mail aperta negli appunti con un solo clic.</p>
        <button class="button" onclick="copySubject()">Copia Oggetto</button>
        <div id="messaggio" class="messaggio"></div>
    </div>
</body>
</html>
